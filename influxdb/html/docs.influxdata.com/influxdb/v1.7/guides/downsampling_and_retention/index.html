<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title> Downsampling and data retention | InfluxData Documentation</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="../../../../img/favicon.ico" type="image/x-icon">

    
    
    
    
    <meta name="docsearch:latest" content="true">
    
    

    
    <meta name="robots" 
        
         content="index, follow"  >

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" title="dark-theme" href="../../../../css/docs-default.css">
    <link rel="alternate stylesheet" title="light-theme" href="https://docs.influxdata.com/css/docs-light.css">

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,400italic,500italic,700,700italic,900,900italic'
        rel='stylesheet' type='text/css'>

    <meta name="application-name" content="InfluxData" />
    <meta name="msapplication-TileColor" content="" />

    <meta name="msapplication-TileImage" content="https://docs.influxdata.com/img/influx-logo-cubo-dark.png" />

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@influxdb">
    <meta name="twitter:title" content=" Downsampling and data retention | InfluxData Documentation">
    <meta name="twitter:description" content="">

    <meta name="twitter:image" content="https://docs.influxdata.com/img/influx-logo-cubo-dark.png" />

    <meta property="fb:app_id" content="222112578359661" />
    <meta property="og:title" content=" Downsampling and data retention | InfluxData Documentation" />
    <meta property="og:description" content="" />
    <meta property="og:url" content="https://docs.influxdata.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://www.influxdata.com/wp-content/uploads/Simple-Kubo.jpg" />
    <meta property="og:image:width" content="555px" />
    <meta property="og:image:height" content="290px" />

    <meta name="Copyright" content="InfluxData Inc." />

    
    <script type="text/javascript" src="https://script.crazyegg.com/pages/scripts/0080/4231.js" async="async"></script>

    <script src="../../../../js/vendor/js.cookie.js" type="text/javascript"></script>
    <script src="../../../../js/docs-themes.js" type="text/javascript"></script>
    <script src="../../../../js/docs-chronograf-url.js" type="text/javascript"></script>
    <script type="text/javascript">
        set_style_from_cookie();

    </script>
</head>

<body      class="docs-theme--influxdb"
               >
    
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WXRH9C');

    </script>
    
    <nav class="navbar" id="main-nav">
    <div class="navbar--logo">
      <a href="https://www.influxdata.com/"  target="_blank" title="Go to InfluxData">
        <span class="icon logo"></span>
        <span class="icon logotype"></span>
      </a>
      <span class="divider"></span>
      <a href="https://docs.influxdata.com/" class="navbar--docs klavika-font" title="Go to Documentation Homepage">Docs</span></a>
    </div>
    

<div class="navbar--hamburger" id="navbar--hamburger">
    <div class="navbar--hamburger-bar top"></div>
    <div class="navbar--hamburger-bar middle"></div>
    <div class="navbar--hamburger-bar bottom"></div>
</div>
<div class="navbar--product-dropdown" id="navbar--dropdown">
    <div class="navbar--current-product">
      
      
        
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          InfluxDB v1.7
        
      
      
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
        
        
      
        
      
        
      
      
        
        
      
        
      
        
      
        
      
        
      
      
      
    </div>
    <div class="navbar--product-dropdown-caret"><span class="icon arrow-down"></span></div>
</div>
<div class="navbar--product-container" id="navbar--product-container">
    <div class="navbar--dropdown-dismiss" id="navbar--dropdown-dismiss"></div>
    <ul class="navbar--product-menu" id="navbar--product-menu">
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/telegraf/v1.13/">Telegraf</a></li>
          
        
          
            <li><a class="navbar--product" href="../../index.html">InfluxDB</a></li>
            <li><a class="navbar--product v2" href="https://v2.docs.influxdata.com" target="_blank">InfluxDB 2.0 <span class="v2-status">beta</span></a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/enterprise_influxdb/v1.7/">InfluxDB Enterprise</a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/chronograf/v1.7/">Chronograf</a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/kapacitor/v1.5/">Kapacitor</a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/enterprise_kapacitor/v1.5/">Kapacitor Enterprise</a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/flux/v0.50/">Flux</a></li>
          
        
        <li class="navbar--product-divider"></li>
        <li><a class="navbar--product external" href="https://influxdata.com/use-cases/" target="_blank">&#9658;&nbsp; See how the TICK Stack is used</a></li>
        <li><a class="navbar--product external" href="https://influxdata.com/pricing/" target="_blank">&#9658;&nbsp; Need help using our stack?</a></li>
    </ul>
</div>


    <div class="navbar--search" id="navbar--search">
	
	
	
	
			
				<input class="navbar--search-field" id="algolia-search-input" type="text" accesskey="s" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" dir="auto" placeholder="Search the docs...">
			
		
	
	
	
	
	
	
</div>

    <button class="theme-switcher" id="theme-switch-light" onclick="switch_style('light-theme');return false;"><span class="icon sun2"></span></button>
<button class="theme-switcher" id="theme-switch-dark" onclick="switch_style('dark-theme');return false;"><span class="icon moon"></span></button>


</nav>


<div class="sidebar--toggle" id="sidebar--toggle"></span>InfluxDB Contents</div>
<aside class="sidebar" id="sidebar">
  <section class="sidebar--section">
    <div id="sidebar--ad"></div>

  </section>
  
  
    
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../about_the_project/index.html">About the project</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../about_the_project/releasenotes-changelog/index.html">Release notes</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../about_the_project/contributing/index.html">Contributing</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../about_the_project/cla/index.html">Contributor license agreement</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../about_the_project/licenses/index.html">InfluxDB license</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../about_the_project/third-party/index.html">Third party software</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../introduction/index.html">Introduction</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../introduction/downloading/index.html">Downloading</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../introduction/installation/index.html">Installing</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../introduction/getting-started/index.html">Getting started</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../concepts/index.html">Concepts</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../concepts/key_concepts/index.html">Key concepts</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../concepts/glossary/index.html">Glossary</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../concepts/crosswalk/index.html">Comparing InfluxDB to SQL databases</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../concepts/insights_tradeoffs/index.html">InfluxDB design insights and tradeoffs</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../concepts/schema_and_data_layout/index.html">Schema design and data layout</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../concepts/storage_engine/index.html">In-memory indexing with TSM</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../concepts/time-series-index/index.html">Time Series Index (TSI) overview</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../concepts/tsi-details/index.html">Time Series Index (TSI) details</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../administration/index.html">Administration</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../administration/config/index.html">Configuring InfluxDB</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/authentication_and_authorization/index.html">Authentication and authorization</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/upgrading/index.html">Upgrading</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/https_setup/index.html">Enabling HTTPS</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/logs/index.html">Logging and tracing</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/ports/index.html">Ports</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/backup_and_restore/index.html">Backing up and restoring</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/rebuild-tsi-index/index.html">Rebuild the TSI index</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/security/index.html">Managing security</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/server_monitoring/index.html">Server monitoring</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/stability_and_compatibility/index.html">Stability and compatibility</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/subscription-management/index.html">Manage subscriptions</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../tools/index.html">Tools</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../tools/shell/index.html">InfluxDB command line interface (CLI/shell)</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../tools/api/index.html">InfluxDB API reference</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../tools/api_client_libraries/index.html">InfluxDB API client libraries</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../tools/influx_inspect/index.html">Influx Inspect disk utility</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../tools/inch/index.html">InfluxDB inch tool</a></li>
              
            
              
                <li><a class="sidebar--page" href="https://grafana.com/docs/grafana/latest/features/datasources/influxdb/">Grafana graphs and dashboards</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../query_language/index.html">Influx Query Language (InfluxQL)</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../query_language/data_download/index.html">Sample data</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/data_exploration/index.html">Data exploration</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/schema_exploration/index.html">Schema exploration</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/database_management/index.html">Data management</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/continuous_queries/index.html">Continuous Queries</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/functions/index.html">Functions</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/math_operators/index.html">Mathematical operators</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/spec/index.html">InfluxQL reference</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../write_protocols/index.html">Write protocols</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../write_protocols/line_protocol_reference/index.html">InfluxDB line protocol reference</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../write_protocols/line_protocol_tutorial/index.html">InfluxDB line protocol tutorial</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../supported_protocols/index.html">Supported protocols</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/collectd/index.html">CollectD</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/graphite/index.html">Graphite</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/opentsdb/index.html">OpenTSDB</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/prometheus/index.html">Prometheus</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/udp/index.html">UDP</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../high_availability/index.html">High availability</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../high_availability/clusters/index.html">Clustering</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../troubleshooting/index.html">Troubleshooting</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../troubleshooting/frequently-asked-questions/index.html">Frequently asked questions (FAQ)</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../troubleshooting/query_management/index.html">Query management</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../troubleshooting/errors/index.html">Error messages</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../additional_resources/additional_resources/index.html">Additional resources</a>
          </div>

          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="index.html">Guides</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../writing_data/index.html">Writing data with the InfluxDB API</a></li>
              
            
              
                <li><a class="sidebar--page" href="../querying_data/index.html">Querying data with the InfluxDB API</a></li>
              
            
              
                <li><a class="sidebar--page active" href="index.html">Downsampling and data retention</a></li>
              
            
              
                <li><a class="sidebar--page" href="../hardware_sizing/index.html">Hardware sizing guidelines</a></li>
              
            
              
                <li><a class="sidebar--page" href="../calculating_percentages/index.html">Calculating percentages in a query</a></li>
              
            
            </ul>
          

        </section>
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  <section class="sidebar--section">
    <div class="sidebar--section-title">
      <a href="https://docs.influxdata.com/influxdb/">InfluxDB versions</a>
    </div>
    <ul>
      
      <li><a class="sidebar--page" href="../../index.html">v1.7</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.6/">v1.6</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.5/">v1.5</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.4/">v1.4</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.3/">v1.3</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.2/">v1.2</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.1/">v1.1</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.0/">v1.0</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.13/">v0.13</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.12/">v0.12</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.11/">v0.11</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.10/">v0.10</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.9/">v0.9</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.8/">v0.8</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.7/">v0.7</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.6/">v0.6</a></li>
      
    </ul>
  </section>
</aside>

<article class="article">
	
	<section class="article-section article-heading">
		<div class="article-content">
			<h1>Downsampling and data retention</h1>
		</div>
	</section>
	
	<section class="article-section">
		<div class="article-content">
			

			

<p>InfluxDB can handle hundreds of thousands of data points per second.
Working with that much data over a long period of time can create storage
concerns.
A natural solution is to downsample the data; keep the high precision raw data
for only a limited time, and store the lower precision, summarized data for much
longer or forever.</p>

<p>InfluxDB offers two features - continuous queries (CQ) and retention policies
(RP) - that automate the process of downsampling data and expiring old data.
This guide describes a practical use case for CQs and RPs and covers how to
set up those features in InfluxDB databases.</p>

<h3 id="definitions">Definitions</h3>

<p>A <strong>continuous query</strong> (CQ) is an InfluxQL query that runs automatically and
periodically within a database.
CQs require a function in the <code>SELECT</code> clause and must include a
<code>GROUP BY time()</code> clause.</p>

<p>A <strong>retention policy</strong> (RP) is the part of InfluxDB data structure
that describes for how long InfluxDB keeps data.
InfluxDB compares your local server&rsquo;s timestamp to the timestamps on your data
and deletes data that are older than the RP&rsquo;s <code>DURATION</code>.
A single database can have several RPs and RPs are unique per database.</p>

<p>This guide will not go into detail about the syntax for creating and managing
CQs and RPs.
If you&rsquo;re new to both concepts, we recommend looking over the detailed
<a href="../../query_language/continuous_queries/index.html">CQ documentation</a> and
<a href="../../query_language/database_management/index.html#retention-policy-management">RP documentation</a>.</p>

<h3 id="sample-data">Sample data</h3>

<p>This section uses fictional real-time data that track the number of food orders
to a restaurant via phone and via website at ten second intervals.
We will store those data in a
<a href="../../concepts/glossary/index.html#database">database</a> called <code>food_data</code>, in
the <a href="../../concepts/glossary/index.html#measurement">measurement</a> <code>orders</code>, and
in the <a href="../../concepts/glossary/index.html#field">fields</a> <code>phone</code> and <code>website</code>.</p>

<p>Sample:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">name: orders
------------
<span class="nb">time</span>                   phone   website
<span class="m">2016</span>-05-10T23:18:00Z   <span class="m">10</span>      <span class="m">30</span>
<span class="m">2016</span>-05-10T23:18:10Z   <span class="m">12</span>      <span class="m">39</span>
<span class="m">2016</span>-05-10T23:18:20Z   <span class="m">11</span>      <span class="m">56</span></code></pre></div>
<h3 id="goal">Goal</h3>

<p>Assume that, in the long run, we&rsquo;re only interested in the average number of orders by phone
and by website at 30 minute intervals.
In the next steps, we use RPs and CQs to:</p>

<ul>
<li>Automatically aggregate the ten-second resolution data to 30-minute resolution data</li>
<li>Automatically delete the raw, ten-second resolution data that are older than two hours</li>
<li>Automatically delete the 30-minute resolution data that are older than 52 weeks</li>
</ul>

<h3 id="database-preparation">Database preparation</h3>

<p>We perform the following steps before writing the data to the database
<code>food_data</code>.
We do this <strong>before</strong> inserting any data because CQs only run against recent
data; that is, data with timestamps that are no older than <code>now()</code> minus
the <code>FOR</code> clause of the CQ, or <code>now()</code> minus the <code>GROUP BY time()</code> interval if
the CQ has no <code>FOR</code> clause.</p>

<h4 id="1-create-the-database">1. Create the database</h4>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="s2">&#34;food_data&#34;</span></code></pre></div>
<h4 id="2-create-a-two-hour-default-retention-policy">2. Create a two-hour <code>DEFAULT</code> retention policy</h4>

<p>InfluxDB writes to the <code>DEFAULT</code> retention policy if we do not supply an explicit RP when
writing a point to the database.
We make the <code>DEFAULT</code> RP keep data for two hours, because we want InfluxDB to
automatically write the incoming ten-second resolution data to that RP.</p>

<p>Use the
<a href="../../query_language/database_management/index.html#create-retention-policies-with-create-retention-policy"><code>CREATE RETENTION POLICY</code></a>
statement to create a <code>DEFAULT</code> RP:</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="n">RETENTION</span> <span class="n">POLICY</span> <span class="s2">&#34;two_hours&#34;</span> <span class="k">ON</span> <span class="s2">&#34;food_data&#34;</span> <span class="n">DURATION</span> <span class="mi">2</span><span class="n">h</span> <span class="n">REPLICATION</span> <span class="mi">1</span> <span class="k">DEFAULT</span></code></pre></div>
<p>That query creates an RP called <code>two_hours</code> that exists in the database
<code>food_data</code>.
<code>two_hours</code> keeps data for a <code>DURATION</code> of two hours (<code>2h</code>) and it&rsquo;s the <code>DEFAULT</code>
RP for the database <code>food_data</code>.</p>


<div class="warn">
  <p>The replication factor (<code>REPLICATION 1</code>) is a required parameter but must always
be set to 1 for single node instances.</p>

</div>


<blockquote>
<p><strong>Note:</strong> When we created the <code>food_data</code> database in step 1, InfluxDB
automatically generated an RP named <code>autogen</code> and set it as the <code>DEFAULT</code>
RP for the database.
The <code>autogen</code> RP has an infinite retention period.
With the query above, the RP <code>two_hours</code> replaces <code>autogen</code> as the <code>DEFAULT</code> RP
for the <code>food_data</code> database.</p>
</blockquote>

<h4 id="3-create-a-52-week-retention-policy">3. Create a 52-week retention policy</h4>

<p>Next we want to create another retention policy that keeps data for 52 weeks and is not the
<code>DEFAULT</code> retention policy (RP) for the database.
Ultimately, the 30-minute rollup data will be stored in this RP.</p>

<p>Use the
<a href="../../query_language/database_management/index.html#create-retention-policies-with-create-retention-policy"><code>CREATE RETENTION POLICY</code></a>
statement to create a non-<code>DEFAULT</code> retention policy:</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="n">RETENTION</span> <span class="n">POLICY</span> <span class="s2">&#34;a_year&#34;</span> <span class="k">ON</span> <span class="s2">&#34;food_data&#34;</span> <span class="n">DURATION</span> <span class="mi">52</span><span class="n">w</span> <span class="n">REPLICATION</span> <span class="mi">1</span></code></pre></div>
<p>That query creates a retention policy (RP) called <code>a_year</code> that exists in the database
<code>food_data</code>.
The <code>a_year</code> setting keeps data for a <code>DURATION</code> of 52 weeks (<code>52w</code>).
Leaving out the <code>DEFAULT</code> argument ensures that <code>a_year</code> is not the <code>DEFAULT</code>
RP for the database <code>food_data</code>.
That is, write and read operations against <code>food_data</code> that do not specify an
RP will still go to the <code>two_hours</code> RP (the <code>DEFAULT</code> RP).</p>

<h4 id="4-create-the-continuous-query">4. Create the continuous query</h4>

<p>Now that we&rsquo;ve set up our RPs, we want to create a continuous query (CQ) that will automatically
and periodically downsample the ten-second resolution data to the 30-minute
resolution, and then store those results in a different measurement with a different
retention policy.</p>

<p>Use the
<a href="../../query_language/continuous_queries/index.html"><code>CREATE CONTINUOUS QUERY</code></a>
statement to generate a CQ:</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="n">CONTINUOUS</span> <span class="n">QUERY</span> <span class="s2">&#34;cq_30m&#34;</span> <span class="k">ON</span> <span class="s2">&#34;food_data&#34;</span> <span class="k">BEGIN</span>
  <span class="k">SELECT</span> <span class="n">mean</span><span class="p">(</span><span class="s2">&#34;website&#34;</span><span class="p">)</span> <span class="k">AS</span> <span class="s2">&#34;mean_website&#34;</span><span class="p">,</span><span class="n">mean</span><span class="p">(</span><span class="s2">&#34;phone&#34;</span><span class="p">)</span> <span class="k">AS</span> <span class="s2">&#34;mean_phone&#34;</span>
  <span class="k">INTO</span> <span class="s2">&#34;a_year&#34;</span><span class="p">.</span><span class="s2">&#34;downsampled_orders&#34;</span>
  <span class="k">FROM</span> <span class="s2">&#34;orders&#34;</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">time</span><span class="p">(</span><span class="mi">30</span><span class="n">m</span><span class="p">)</span>
<span class="k">END</span></code></pre></div>
<p>That query creates a CQ called <code>cq_30m</code> in the database <code>food_data</code>.
<code>cq_30m</code> tells InfluxDB to calculate the 30-minute average of the two fields
<code>website</code> and <code>phone</code> in the measurement <code>orders</code> and in the <code>DEFAULT</code> RP
<code>two_hours</code>.
It also tells InfluxDB to write those results to the measurement
<code>downsampled_orders</code> in the retention policy <code>a_year</code> with the field keys
<code>mean_website</code> and <code>mean_phone</code>.
InfluxDB will run this query every 30 minutes for the previous 30 minutes.</p>

<blockquote>
<p><strong>Note:</strong> Notice that we fully qualify (that is, we use the syntax
<code>&quot;&lt;retention_policy&gt;&quot;.&quot;&lt;measurement&gt;&quot;</code>) the measurement in the <code>INTO</code>
clause.
InfluxDB requires that syntax to write data to an RP other than the <code>DEFAULT</code>
RP.</p>
</blockquote>

<h3 id="results">Results</h3>

<p>With the new CQ and two new RPs, <code>food_data</code> is ready to start receiving data.
After writing data to our database and letting things run for a bit, we see
two measurements: <code>orders</code> and <code>downsampled_orders</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="s2">&#34;orders&#34;</span> <span class="k">LIMIT</span> <span class="mi">5</span>
<span class="n">name</span><span class="p">:</span> <span class="n">orders</span>
<span class="c1">---------
</span><span class="c1"></span><span class="n">time</span>                    <span class="n">phone</span>  <span class="n">website</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T23</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span>    <span class="mi">10</span>     <span class="mi">30</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T23</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">10</span><span class="n">Z</span>    <span class="mi">12</span>     <span class="mi">39</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T23</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">20</span><span class="n">Z</span>    <span class="mi">11</span>     <span class="mi">56</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T23</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="n">Z</span>    <span class="mi">8</span>      <span class="mi">34</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T23</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">40</span><span class="n">Z</span>    <span class="mi">17</span>     <span class="mi">32</span>

<span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="s2">&#34;a_year&#34;</span><span class="p">.</span><span class="s2">&#34;downsampled_orders&#34;</span> <span class="k">LIMIT</span> <span class="mi">5</span>
<span class="n">name</span><span class="p">:</span> <span class="n">downsampled_orders</span>
<span class="c1">---------------------
</span><span class="c1"></span><span class="n">time</span>                    <span class="n">mean_phone</span>  <span class="n">mean_website</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T15</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span>    <span class="mi">12</span>          <span class="mi">23</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span>    <span class="mi">13</span>          <span class="mi">32</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T16</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span>    <span class="mi">19</span>          <span class="mi">21</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T16</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span>    <span class="mi">3</span>           <span class="mi">26</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">13</span><span class="n">T17</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="n">Z</span>    <span class="mi">4</span>           <span class="mi">23</span></code></pre></div>
<p>The data in <code>orders</code> are the raw, ten-second resolution data that reside in the
two-hour RP.
The data in <code>downsampled_orders</code> are the aggregated, 30-minute resolution data
that are subject to the 52-week RP.</p>

<p>Notice that the first timestamps in <code>downsampled_orders</code> are older than the first
timestamps in <code>orders</code>.
This is because InfluxDB has already deleted data from <code>orders</code> with timestamps
that are older than our local server&rsquo;s timestamp minus two hours (assume we
  executed the <code>SELECT</code> queries at <code>2016-05-14T00:59:59Z</code>).
InfluxDB will only start dropping data from <code>downsampled_orders</code> after 52 weeks.</p>

<blockquote>
<p><strong>Notes:</strong></p>

<ul>
<li><p>Notice that we fully qualify (that is, we use the syntax
<code>&quot;&lt;retention_policy&gt;&quot;.&quot;&lt;measurement&gt;&quot;</code>) <code>downsampled_orders</code> in
the second <code>SELECT</code> statement. We must specify the RP in that query to <code>SELECT</code>
data that reside in an RP other than the <code>DEFAULT</code> RP.</p></li>

<li><p>By default, InfluxDB checks to enforce an RP every 30 minutes.
Between checks, <code>orders</code> may have data that are older than two hours.
The rate at which InfluxDB checks to enforce an RP is a configurable setting,
see
<a href="../../administration/config.html#check-interval-30m0s">Database Configuration</a>.</p></li>
</ul>
</blockquote>

<p>Using a combination of RPs and CQs, we&rsquo;ve successfully set up our database to
automatically keep the high precision raw data for a limited time, create lower
precision data, and store that lower precision data for a longer period of time.
Now that you have a general understanding of how these features can work
together, check out the detailed documentation on <a href="../../query_language/continuous_queries/index.html">CQs</a> and <a href="../../query_language/database_management/index.html#retention-policy-management">RPs</a>
to see all that they can do for you.</p>

		</div>
	</section>
	
<section class="article-section article-footer">
	<div class="article-content">
		<p><span class="icon logo" style="margin-right: 1em;"></span> This documentation is <a href="https://github.com/influxdata/docs.influxdata.com/blob/master/content/influxdb/v1.7/guides/downsampling_and_retention.md">open source</a>. See a typo? Please, open an <a href="https://github.com/influxdata/docs.influxdata.com/issues/new">issue</a>.</p>
		<br/>
		<p><span class="icon bubbles2" style="margin-right: 1em;"></span><strong>Need help getting up and running?</strong> <a href="https://www.influxdata.com/products/services/" target="_blank">Get Support</a></p>
	</div>
</section>


</article>
<script>window.jQuery || document.write('<script src="../../../../js/vendor/jquery-2.1.4.min.js"><\/script>')</script>

<script src="../../../../js/docs-interactions.js" type="text/javascript"></script>
<script>
  $("h2, h3, h4").each(function() {
  var link = "<a href="https://docs.influxdata.com/influxdb/v1.7/guides/downsampling_and_retention/\&quot;#"" + $(this).attr("id") + "\"></a>"
  $(this).wrapInner( link );
  })
</script>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-45024174-5', 'auto');ga('send', 'pageview');</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
  docsearch({
    apiKey: 'ba4435a9d456ac0d954cc276206eac06',
    appId: 'WHM9UWMP6M',
    indexName: 'influxdata',
    inputSelector: '#algolia-search-input',
    algoliaOptions: {
      hitsPerPage: 15,
      facets: [ "project", "version", "latest"],
      facetFilters: [ "latest:true" ]
    }
  });
</script>
</body>
</html>

<div class="modal-overlay"></div>
<div id="chronograf-url-modal" class="modal-content">
    <label>Chronograf Data Explorer URL</label>
    <form class="flex-form" id="save-chronograf-url">
        <input type="text" id="chronograf-url" name="chronograf-url"/>
        <button class="save-btn"><span>Save</span></button>
    </form>
    <a id="default-chronograf-url">Revert to Default</a>
</div>

