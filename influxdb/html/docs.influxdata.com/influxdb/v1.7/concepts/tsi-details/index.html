<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title> Time Series Index (TSI) details | InfluxData Documentation</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="../../../../img/favicon.ico" type="image/x-icon">

    
    
    
    
    <meta name="docsearch:latest" content="true">
    
    

    
    <meta name="robots" 
        
         content="index, follow"  >

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" title="dark-theme" href="../../../../css/docs-default.css">
    <link rel="alternate stylesheet" title="light-theme" href="https://docs.influxdata.com/css/docs-light.css">

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,400italic,500italic,700,700italic,900,900italic'
        rel='stylesheet' type='text/css'>

    <meta name="application-name" content="InfluxData" />
    <meta name="msapplication-TileColor" content="" />

    <meta name="msapplication-TileImage" content="https://docs.influxdata.com/img/influx-logo-cubo-dark.png" />

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@influxdb">
    <meta name="twitter:title" content=" Time Series Index (TSI) details | InfluxData Documentation">
    <meta name="twitter:description" content="">

    <meta name="twitter:image" content="https://docs.influxdata.com/img/influx-logo-cubo-dark.png" />

    <meta property="fb:app_id" content="222112578359661" />
    <meta property="og:title" content=" Time Series Index (TSI) details | InfluxData Documentation" />
    <meta property="og:description" content="" />
    <meta property="og:url" content="https://docs.influxdata.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://www.influxdata.com/wp-content/uploads/Simple-Kubo.jpg" />
    <meta property="og:image:width" content="555px" />
    <meta property="og:image:height" content="290px" />

    <meta name="Copyright" content="InfluxData Inc." />

    
    <script type="text/javascript" src="https://script.crazyegg.com/pages/scripts/0080/4231.js" async="async"></script>

    <script src="../../../../js/vendor/js.cookie.js" type="text/javascript"></script>
    <script src="../../../../js/docs-themes.js" type="text/javascript"></script>
    <script src="../../../../js/docs-chronograf-url.js" type="text/javascript"></script>
    <script type="text/javascript">
        set_style_from_cookie();

    </script>
</head>

<body      class="docs-theme--influxdb"
               >
    
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WXRH9C');

    </script>
    
    <nav class="navbar" id="main-nav">
    <div class="navbar--logo">
      <a href="https://www.influxdata.com/"  target="_blank" title="Go to InfluxData">
        <span class="icon logo"></span>
        <span class="icon logotype"></span>
      </a>
      <span class="divider"></span>
      <a href="https://docs.influxdata.com/" class="navbar--docs klavika-font" title="Go to Documentation Homepage">Docs</span></a>
    </div>
    

<div class="navbar--hamburger" id="navbar--hamburger">
    <div class="navbar--hamburger-bar top"></div>
    <div class="navbar--hamburger-bar middle"></div>
    <div class="navbar--hamburger-bar bottom"></div>
</div>
<div class="navbar--product-dropdown" id="navbar--dropdown">
    <div class="navbar--current-product">
      
      
        
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          InfluxDB v1.7
        
      
      
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
        
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
        
        
      
        
      
        
      
      
        
        
      
        
      
        
      
        
      
        
      
      
      
    </div>
    <div class="navbar--product-dropdown-caret"><span class="icon arrow-down"></span></div>
</div>
<div class="navbar--product-container" id="navbar--product-container">
    <div class="navbar--dropdown-dismiss" id="navbar--dropdown-dismiss"></div>
    <ul class="navbar--product-menu" id="navbar--product-menu">
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/telegraf/v1.13/">Telegraf</a></li>
          
        
          
            <li><a class="navbar--product" href="../../index.html">InfluxDB</a></li>
            <li><a class="navbar--product v2" href="https://v2.docs.influxdata.com" target="_blank">InfluxDB 2.0 <span class="v2-status">beta</span></a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/enterprise_influxdb/v1.7/">InfluxDB Enterprise</a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/chronograf/v1.7/">Chronograf</a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/kapacitor/v1.5/">Kapacitor</a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/enterprise_kapacitor/v1.5/">Kapacitor Enterprise</a></li>
          
        
          
            <li><a class="navbar--product" href="https://docs.influxdata.com/flux/v0.50/">Flux</a></li>
          
        
        <li class="navbar--product-divider"></li>
        <li><a class="navbar--product external" href="https://influxdata.com/use-cases/" target="_blank">&#9658;&nbsp; See how the TICK Stack is used</a></li>
        <li><a class="navbar--product external" href="https://influxdata.com/pricing/" target="_blank">&#9658;&nbsp; Need help using our stack?</a></li>
    </ul>
</div>


    <div class="navbar--search" id="navbar--search">
	
	
	
	
			
				<input class="navbar--search-field" id="algolia-search-input" type="text" accesskey="s" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" dir="auto" placeholder="Search the docs...">
			
		
	
	
	
	
	
	
</div>

    <button class="theme-switcher" id="theme-switch-light" onclick="switch_style('light-theme');return false;"><span class="icon sun2"></span></button>
<button class="theme-switcher" id="theme-switch-dark" onclick="switch_style('dark-theme');return false;"><span class="icon moon"></span></button>


</nav>


<div class="sidebar--toggle" id="sidebar--toggle"></span>InfluxDB Contents</div>
<aside class="sidebar" id="sidebar">
  <section class="sidebar--section">
    <div id="sidebar--ad"></div>

  </section>
  
  
    
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../about_the_project/index.html">About the project</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../about_the_project/releasenotes-changelog/index.html">Release notes</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../about_the_project/contributing/index.html">Contributing</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../about_the_project/cla/index.html">Contributor license agreement</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../about_the_project/licenses/index.html">InfluxDB license</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../about_the_project/third-party/index.html">Third party software</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../introduction/index.html">Introduction</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../introduction/downloading/index.html">Downloading</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../introduction/installation/index.html">Installing</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../introduction/getting-started/index.html">Getting started</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class=" active" href="../index.html">Concepts</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../key_concepts/index.html">Key concepts</a></li>
              
            
              
                <li><a class="sidebar--page" href="../glossary/index.html">Glossary</a></li>
              
            
              
                <li><a class="sidebar--page" href="../crosswalk/index.html">Comparing InfluxDB to SQL databases</a></li>
              
            
              
                <li><a class="sidebar--page" href="../insights_tradeoffs/index.html">InfluxDB design insights and tradeoffs</a></li>
              
            
              
                <li><a class="sidebar--page" href="../schema_and_data_layout/index.html">Schema design and data layout</a></li>
              
            
              
                <li><a class="sidebar--page" href="../storage_engine/index.html">In-memory indexing with TSM</a></li>
              
            
              
                <li><a class="sidebar--page" href="../time-series-index/index.html">Time Series Index (TSI) overview</a></li>
              
            
              
                <li><a class="sidebar--page active" href="index.html">Time Series Index (TSI) details</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../administration/index.html">Administration</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../administration/config/index.html">Configuring InfluxDB</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/authentication_and_authorization/index.html">Authentication and authorization</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/upgrading/index.html">Upgrading</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/https_setup/index.html">Enabling HTTPS</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/logs/index.html">Logging and tracing</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/ports/index.html">Ports</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/backup_and_restore/index.html">Backing up and restoring</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/rebuild-tsi-index/index.html">Rebuild the TSI index</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/security/index.html">Managing security</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/server_monitoring/index.html">Server monitoring</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/stability_and_compatibility/index.html">Stability and compatibility</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../administration/subscription-management/index.html">Manage subscriptions</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../tools/index.html">Tools</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../tools/shell/index.html">InfluxDB command line interface (CLI/shell)</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../tools/api/index.html">InfluxDB API reference</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../tools/api_client_libraries/index.html">InfluxDB API client libraries</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../tools/influx_inspect/index.html">Influx Inspect disk utility</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../tools/inch/index.html">InfluxDB inch tool</a></li>
              
            
              
                <li><a class="sidebar--page" href="https://grafana.com/docs/grafana/latest/features/datasources/influxdb/">Grafana graphs and dashboards</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../query_language/index.html">Influx Query Language (InfluxQL)</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../query_language/data_download/index.html">Sample data</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/data_exploration/index.html">Data exploration</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/schema_exploration/index.html">Schema exploration</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/database_management/index.html">Data management</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/continuous_queries/index.html">Continuous Queries</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/functions/index.html">Functions</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/math_operators/index.html">Mathematical operators</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../query_language/spec/index.html">InfluxQL reference</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../write_protocols/index.html">Write protocols</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../write_protocols/line_protocol_reference/index.html">InfluxDB line protocol reference</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../write_protocols/line_protocol_tutorial/index.html">InfluxDB line protocol tutorial</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../supported_protocols/index.html">Supported protocols</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/collectd/index.html">CollectD</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/graphite/index.html">Graphite</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/opentsdb/index.html">OpenTSDB</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/prometheus/index.html">Prometheus</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../supported_protocols/udp/index.html">UDP</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../high_availability/index.html">High availability</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../high_availability/clusters/index.html">Clustering</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../troubleshooting/index.html">Troubleshooting</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../troubleshooting/frequently-asked-questions/index.html">Frequently asked questions (FAQ)</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../troubleshooting/query_management/index.html">Query management</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../troubleshooting/errors/index.html">Error messages</a></li>
              
            
            </ul>
          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="../../additional_resources/additional_resources/index.html">Additional resources</a>
          </div>

          

        </section>
      
        <section class="sidebar--section">
          <div class="sidebar--section-title">
            <a class="" href="index.html">Guides</a>
          </div>

          
            <ul>
            
              
                <li><a class="sidebar--page" href="../../guides/writing_data/index.html">Writing data with the InfluxDB API</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../guides/querying_data/index.html">Querying data with the InfluxDB API</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../guides/downsampling_and_retention/index.html">Downsampling and data retention</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../guides/hardware_sizing/index.html">Hardware sizing guidelines</a></li>
              
            
              
                <li><a class="sidebar--page" href="../../guides/calculating_percentages/index.html">Calculating percentages in a query</a></li>
              
            
            </ul>
          

        </section>
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  <section class="sidebar--section">
    <div class="sidebar--section-title">
      <a href="https://docs.influxdata.com/influxdb/">InfluxDB versions</a>
    </div>
    <ul>
      
      <li><a class="sidebar--page" href="../../index.html">v1.7</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.6/">v1.6</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.5/">v1.5</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.4/">v1.4</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.3/">v1.3</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.2/">v1.2</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.1/">v1.1</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v1.0/">v1.0</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.13/">v0.13</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.12/">v0.12</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.11/">v0.11</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.10/">v0.10</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.9/">v0.9</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.8/">v0.8</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.7/">v0.7</a></li>
      
      <li><a class="sidebar--page" href="https://docs.influxdata.com/influxdb/v0.6/">v0.6</a></li>
      
    </ul>
  </section>
</aside>

<article class="article">
	
	<section class="article-section article-heading">
		<div class="article-content">
			<h1>Time Series Index (TSI) details</h1>
		</div>
	</section>
	
	<section class="article-section">
		<div class="article-content">
			

			

<p>When InfluxDB ingests data, we store not only the value but we also index the measurement and tag information so that it can be queried quickly.
In earlier versions, index data could only be stored in-memory, however, that requires a lot of RAM and places an upper bound on the number of series a machine can hold.
This upper bound is usually somewhere between 1 - 4 million series depending on the machine used.</p>

<p>The Time Series Index (TSI) was developed to allow us to go past that upper bound.
TSI stores index data on disk so that we are no longer restricted by RAM.
TSI uses the operating system&rsquo;s page cache to pull hot data into memory and let cold data rest on disk.</p>

<h2 id="enable-tsi">Enable TSI</h2>

<p>To enable TSI, set the following line in the InfluxDB configuration file (<code>influxdb.conf</code>):</p>

<pre><code>index-version = &quot;tsi1&quot;
</code></pre>

<p>(Be sure to include the double quotes.)</p>

<h3 id="influxdb-enterprise">InfluxDB Enterprise</h3>

<ul>
<li><p>To convert your data nodes to support TSI, see <a href="https://docs.influxdata.com/enterprise_influxdb/v1.7/administration/upgrading/">Upgrade InfluxDB Enterprise clusters</a>.</p></li>

<li><p>For detail on configuration, see <a href="https://docs.influxdata.com/enterprise_influxdb/v1.7/administration/configuration/#sidebar">Configure InfluxDB Enterprise clusters</a>.</p></li>
</ul>

<h3 id="influxdb-oss">InfluxDB OSS</h3>

<ul>
<li>For detail on configuration, see <a href="../../administration/config/index.html#sidebar">Configuring InfluxDB OSS</a>.</li>
</ul>

<h2 id="tooling">Tooling</h2>

<h3 id="influx-inspect-dumptsi"><code>influx_inspect dumptsi</code></h3>

<p>If you are troubleshooting an issue with an index, you can use the <code>influx_inspect dumptsi</code> command.
This command allows you to print summary statistics on an index, file, or a set of files.
This command only works on one index at a time.</p>

<p>For details on this command, see <a href="../../tools/influx_inspect/index.html#dumptsi">influx_inspect dumptsi</a>.</p>

<h3 id="influx-inspect-buildtsi"><code>influx_inspect buildtsi</code></h3>

<p>If you want to convert an existing shard from an in-memory index to a TSI index, or if you have an existing TSI index which has become corrupt, you can use the <code>buildtsi</code> command to create the index from the underlying TSM data.
If you have an existing TSI index that you want to rebuild, first delete the <code>index</code> directory within your shard.</p>

<p>This command works at the server-level but you can optionally add database, retention policy and shard filters to only apply to a subset of shards.</p>

<p>For details on this command, see <a href="../../tools/influx_inspect/index.html#buildtsi">influx inspect buildtsi</a>.</p>

<h2 id="understanding-tsi">Understanding TSI</h2>

<h3 id="file-organization">File organization</h3>

<p>TSI (Time Series Index) is a log-structured merge tree-based database for InfluxDB series data.
TSI is composed of several parts:</p>

<ul>
<li><p><strong>Index</strong>: Contains the entire index dataset for a single shard.</p></li>

<li><p><strong>Partition</strong>: Contains a sharded partition of the data for a shard.</p></li>

<li><p><strong>LogFile</strong>: Contains newly written series as an in-memory index and is persisted as a WAL.</p></li>

<li><p><strong>IndexFile</strong>: Contains an immutable, memory-mapped index built from a LogFile or merged from two contiguous index files.</p></li>
</ul>

<p>There is also a <strong>SeriesFile</strong> which contains a set of all series keys across the entire database.
Each shard within the database shares the same series file.</p>

<h3 id="writes">Writes</h3>

<p>The following occurs when a write comes into the system:</p>

<ol>
<li>Series is added to the series file or is looked up if it already exists. This returns an auto-incrementing series ID.</li>
<li>The series is sent to the Index. The index maintains a roaring bitmap of existing series IDs and ignores series that have already been created.</li>
<li>The series is hashed and sent to the appropriate Partition.</li>
<li>The Partition writes the series as an entry to the LogFile.</li>
<li>The LogFile writes the series to a write-ahead log file on disk and adds the series to a set of in-memory indexes.</li>
</ol>

<h3 id="compaction">Compaction</h3>

<p>Once the LogFile exceeds a threshold (5MB), then a new active log file is created and the previous one begins compacting into an IndexFile.
This first index file is at level 1 (L1).
The log file is considered level 0 (L0).</p>

<p>Index files can also be created by merging two smaller index files together.
For example, if contiguous two L1 index files exist then they can be merged into an L2 index file.</p>

<h3 id="reads">Reads</h3>

<p>The index provides several API calls for retrieving sets of data such as:</p>

<ul>
<li><code>MeasurementIterator()</code>: Returns a sorted list of measurement names.</li>
<li><code>TagKeyIterator()</code>: Returns a sorted list of tag keys in a measurement.</li>
<li><code>TagValueIterator()</code>: Returns a sorted list of tag values for a tag key.</li>
<li><code>MeasurementSeriesIDIterator()</code>: Returns a sorted list of all series IDs for a measurement.</li>
<li><code>TagKeySeriesIDIterator()</code>: Returns a sorted list of all series IDs for a tag key.</li>
<li><code>TagValueSeriesIDIterator()</code>: Returns a sorted list of all series IDs for a tag value.</li>
</ul>

<p>These iterators are all composable using several merge iterators.
For each type of iterator (measurement, tag key, tag value, series id), there are multiple merge iterator types:</p>

<ul>
<li><strong>Merge</strong>: Deduplicates items from two iterators.</li>
<li><strong>Intersect</strong>: Returns only items that exist in two iterators.</li>
<li><strong>Difference</strong>: Only returns items from first iterator that don&rsquo;t exist in the second iterator.</li>
</ul>

<p>For example, a query with a WHERE clause of <code>region != 'us-west'</code> that operates across two shards will construct a set of iterators like this:</p>

<pre><code>DifferenceSeriesIDIterators(
    MergeSeriesIDIterators(
        Shard1.MeasurementSeriesIDIterator(&quot;m&quot;),
        Shard2.MeasurementSeriesIDIterator(&quot;m&quot;),
    ),
    MergeSeriesIDIterators(
        Shard1.TagValueSeriesIDIterator(&quot;m&quot;, &quot;region&quot;, &quot;us-west&quot;),
        Shard2.TagValueSeriesIDIterator(&quot;m&quot;, &quot;region&quot;, &quot;us-west&quot;),
    ),
)
</code></pre>

<h3 id="log-file-structure">Log File Structure</h3>

<p>The log file is simply structured as a list of LogEntry objects written to disk in sequential order. Log files are written until they reach 5MB and then they are compacted into index files.
The entry objects in the log can be of any of the following types:</p>

<ul>
<li>AddSeries</li>
<li>DeleteSeries</li>
<li>DeleteMeasurement</li>
<li>DeleteTagKey</li>
<li>DeleteTagValue</li>
</ul>

<p>The in-memory index on the log file tracks the following:</p>

<ul>
<li>Measurements by name</li>
<li>Tag keys by measurement</li>
<li>Tag values by tag key</li>
<li>Series by measurement</li>
<li>Series by tag value</li>
<li>Tombstones for series, measurements, tag keys, and tag values.</li>
</ul>

<p>The log file also maintains bitsets for series ID existence and tombstones.
These bitsets are merged with other log files and index files to regenerate the full index bitset on startup.</p>

<h3 id="index-file-structure">Index File Structure</h3>

<p>The index file is an immutable file that tracks similar information to the log file, but all data is indexed and written to disk so that it can be directly accessed from a memory-map.</p>

<p>The index file has the following sections:</p>

<ul>
<li><strong>TagBlocks:</strong> Maintains an index of tag values for a single tag key.</li>
<li><strong>MeasurementBlock:</strong> Maintains an index of measurements and their tag keys.</li>
<li><strong>Trailer:</strong> Stores offset information for the file as well as HyperLogLog sketches for cardinality estimation.</li>
</ul>

<h3 id="manifest">Manifest</h3>

<p>The MANIFEST file is stored in the index directory and lists all the files that belong to the index and the order in which they should be accessed.
This file is updated every time a compaction occurs.
Any files that are in the directory that are not in the index file are index files that are in the process of being compacted.</p>

<h3 id="fileset">FileSet</h3>

<p>A file set is an in-memory snapshot of the manifest that is obtained while the InfluxDB process is running.
This is required to provide a consistent view of the index at a point-in-time.
The file set also facilitates reference counting for all of its files so that no file will be deleted via compaction until all readers of the file are done with it.</p>

		</div>
	</section>
	
<section class="article-section article-footer">
	<div class="article-content">
		<p><span class="icon logo" style="margin-right: 1em;"></span> This documentation is <a href="https://github.com/influxdata/docs.influxdata.com/blob/master/content/influxdb/v1.7/concepts/tsi-details.md">open source</a>. See a typo? Please, open an <a href="https://github.com/influxdata/docs.influxdata.com/issues/new">issue</a>.</p>
		<br/>
		<p><span class="icon bubbles2" style="margin-right: 1em;"></span><strong>Need help getting up and running?</strong> <a href="https://www.influxdata.com/products/services/" target="_blank">Get Support</a></p>
	</div>
</section>


</article>
<script>window.jQuery || document.write('<script src="../../../../js/vendor/jquery-2.1.4.min.js"><\/script>')</script>

<script src="../../../../js/docs-interactions.js" type="text/javascript"></script>
<script>
  $("h2, h3, h4").each(function() {
  var link = "<a href="https://docs.influxdata.com/influxdb/v1.7/concepts/tsi-details/\&quot;#"" + $(this).attr("id") + "\"></a>"
  $(this).wrapInner( link );
  })
</script>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-45024174-5', 'auto');ga('send', 'pageview');</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
  docsearch({
    apiKey: 'ba4435a9d456ac0d954cc276206eac06',
    appId: 'WHM9UWMP6M',
    indexName: 'influxdata',
    inputSelector: '#algolia-search-input',
    algoliaOptions: {
      hitsPerPage: 15,
      facets: [ "project", "version", "latest"],
      facetFilters: [ "latest:true" ]
    }
  });
</script>
</body>
</html>

<div class="modal-overlay"></div>
<div id="chronograf-url-modal" class="modal-content">
    <label>Chronograf Data Explorer URL</label>
    <form class="flex-form" id="save-chronograf-url">
        <input type="text" id="chronograf-url" name="chronograf-url"/>
        <button class="save-btn"><span>Save</span></button>
    </form>
    <a id="default-chronograf-url">Revert to Default</a>
</div>

